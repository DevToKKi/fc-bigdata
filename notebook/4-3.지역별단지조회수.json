{"paragraphs":[{"title":"1. RDS 단지master 읽어 오기","text":"import java.sql.Connection\nimport java.sql.Statement\nimport java.sql.DriverManager\n\nval url = \"jdbc:mysql://sparkline.cp7ovqbewwso.ap-northeast-2.rds.amazonaws.com:3306/dw?characterEncoding=UTF-8\"\nval user: String =\"sparkline\"\nval pass: String=\"sparkline\" \n \n \nval prop = new java.util.Properties\nprop.setProperty(\"driver\", \"com.mysql.jdbc.Driver\")\nprop.setProperty(\"user\", user)\nprop.setProperty(\"password\",pass) \n \n val danjiMasterQuery = \"\"\"(\n        select id,\n               danji_name, \n               sido, \n               sigungu,\n               dong \n        from apart_master\n\n ) a\"\"\"\n \n  val danjiMasterDF = spark.read.format(\"jdbc\").option(\"url\",url).option(\"dbtable\", danjiMasterQuery).option(\"user\", user).option(\"password\", pass).option(\"useUnicode\", \"true\").option(\"characterEncoding\",\"utf8\").load()\n\n\ndanjiMasterDF.createOrReplaceTempView(\"danji_master\")\nsqlContext.cacheTable(\"danji_master\")","user":"anonymous","dateUpdated":"2020-01-30T14:51:15+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","title":true,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1580395420487_664668961","id":"20181010-131003_1236523071","dateCreated":"2020-01-30T14:43:40+0000","dateStarted":"2020-01-30T14:51:15+0000","dateFinished":"2020-01-30T14:51:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:25881","errorMessage":""},{"title":"2. spark 스키마에 있는 테이블 확인한다.","text":"%sql\nshow tables from njkwon","user":"anonymous","dateUpdated":"2020-01-30T14:50:32+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"database":"string","tableName":"string","isTemporary":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1580395420488_1858500481","id":"20181010-131714_965893710","dateCreated":"2020-01-30T14:43:40+0000","dateStarted":"2020-01-30T14:49:59+0000","dateFinished":"2020-01-30T14:50:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:25882","errorMessage":""},{"title":"3. Glue에 정의 되어 있는 테이블 테이블확인","text":"%sql\ndesc njkwon.danji_user_view","user":"anonymous","dateUpdated":"2020-01-30T14:50:50+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"col_name":"string","data_type":"string","comment":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1580395420488_1612264680","id":"20181010-131758_996378101","dateCreated":"2020-01-30T14:43:40+0000","dateStarted":"2020-01-30T14:50:49+0000","dateFinished":"2020-01-30T14:50:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:25883","errorMessage":""},{"title":"4. danji_master 테이블확인","text":"%sql\ndesc danji_master\n","user":"anonymous","dateUpdated":"2020-01-30T14:50:57+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1580395420489_-1317935501","id":"20181010-132142_687104021","dateCreated":"2020-01-30T14:43:40+0000","dateStarted":"2020-01-30T14:50:57+0000","dateFinished":"2020-01-30T14:50:57+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:25884","errorMessage":""},{"title":"5. Glue에 정의 된 테이블과 RDS master 테이블 Join","text":"%sql\nselect a.base_date, \n       a.danji_id, \n       b.danji_name,\n       b.sido,\n       b.sigungu,\n       b.dong,\n       count(*) as view_count\nfrom njkwon.danji_user_view a \njoin danji_master b\non a.danji_id = b.id \ngroup by a.base_date, \n       a.danji_id, \n       b.danji_name,\n       b.sido,\n       b.sigungu,\n       b.dong\n","user":"anonymous","dateUpdated":"2020-01-30T14:52:30+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"base_date":"string","danji_id":"string","danji_name":"string","sido":"string","sigungu":"string","dong":"string","view_count":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1580395420489_-1432694278","id":"20181010-131010_1970714607","dateCreated":"2020-01-30T14:43:40+0000","dateStarted":"2020-01-30T14:52:02+0000","dateFinished":"2020-01-30T14:52:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:25885","errorMessage":""},{"title":"6. RDS 저장한다.","text":"val localDanjiCountDF = sqlContext.sql(s\"\"\"\n\nselect a.base_date, \n       a.danji_id, \n       b.danji_name,\n       b.sido,\n       b.sigungu,\n       b.dong,\n       count(*) as view_count\nfrom njkwon.danji_user_view a \njoin danji_master b\non a.danji_id = b.id \ngroup by a.base_date, \n       a.danji_id, \n       b.danji_name,\n       b.sido,\n       b.sigungu,\n       b.dong\n\n\"\"\")\n\nval tableName = \"dm.local_danji_summary_njkwon\"\nlocalDanjiCountDF.write.mode(\"append\").jdbc(url, tableName, prop)\n","user":"anonymous","dateUpdated":"2020-01-30T14:55:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","title":true,"results":{},"enabled":true,"fontSize":9},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1580395420489_422901440","id":"20181010-131655_2141924504","dateCreated":"2020-01-30T14:43:40+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:25886","dateFinished":"2020-01-30T14:55:23+0000","dateStarted":"2020-01-30T14:55:08+0000"},{"user":"anonymous","dateUpdated":"2020-01-30T14:43:40+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"fontSize":9},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1580395420489_2106700604","id":"20181010-132637_884037669","dateCreated":"2020-01-30T14:43:40+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:25887"}],"name":"4-3.지역별단지조회수","id":"2F2BNJQXJ","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}